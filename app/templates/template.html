<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Conversor y Calculadora Multibase</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
  </head>

  <body class="bg-light">
    <div class="container py-5">
      <div class="row justify-content-center">
        <div class="col-12 col-md-8 col-lg-7">
          <div class="card shadow-sm">
            <div class="card-body">
              <h3 class="text-center mb-4">
                Calculadora y Conversiones Multibase
              </h3>

              <form id="calcForm">
                <!-- PRIMER NÚMERO -->
                <h5>Primer número</h5>
                <div class="row mb-3">
                  <div class="col-8">
                    <input
                      id="a"
                      class="form-control"
                      placeholder="Valor"
                      required
                    />
                  </div>
                  <div class="col-4">
                    <select id="base_a" class="form-select">
                      <option value="2">Base 2</option>
                      <option value="3">Base 3</option>
                      <option value="4">Base 4</option>
                      <option value="5">Base 5</option>
                      <option value="6">Base 6</option>
                      <option value="7">Base 7</option>
                      <option value="8">Base 8</option>
                      <option value="9">Base 9</option>
                      <option value="10" selected>Base 10</option>
                    </select>
                  </div>
                </div>

                <!-- SEGUNDO NÚMERO -->
                <h5>Segundo número</h5>
                <div class="row mb-3">
                  <div class="col-8">
                    <input
                      id="b"
                      class="form-control"
                      placeholder="Valor"
                      required
                    />
                  </div>
                  <div class="col-4">
                    <select id="base_b" class="form-select">
                      <option value="2">Base 2</option>
                      <option value="3">Base 3</option>
                      <option value="4">Base 4</option>
                      <option value="5">Base 5</option>
                      <option value="6">Base 6</option>
                      <option value="7">Base 7</option>
                      <option value="8">Base 8</option>
                      <option value="9">Base 9</option>
                      <option value="10" selected>Base 10</option>
                    </select>
                  </div>
                </div>

                <!-- OPERACIÓN -->
                <div class="mb-3">
                  <label class="form-label">Operación</label>
                  <select id="op" class="form-select">
                    <option value="add">Suma</option>
                    <option value="sub">Resta</option>
                    <option value="mul">Multiplicación</option>
                    <option value="div">División</option>
                  </select>
                </div>

                <!-- BASE RESULTADO -->
                <div class="mb-3">
                  <label class="form-label">Base para el resultado</label>
                  <select id="result_base" class="form-select">
                    <option value="2">Base 2</option>
                    <option value="3">Base 3</option>
                    <option value="4">Base 4</option>
                    <option value="5">Base 5</option>
                    <option value="6">Base 6</option>
                    <option value="7">Base 7</option>
                    <option value="8">Base 8</option>
                    <option value="9">Base 9</option>
                    <option value="10" selected>Base 10</option>
                  </select>
                </div>

                <div class="d-grid">
                  <button type="submit" class="btn btn-primary">
                    Calcular
                  </button>
                </div>
              </form>

              <div id="result" class="mt-3"></div>
              <div id="error" class="mt-2 text-danger"></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      const form = document.getElementById("calcForm");
      const resultEl = document.getElementById("result");
      const errorEl = document.getElementById("error");

      form.addEventListener("submit", async (e) => {
        e.preventDefault();
        resultEl.textContent = "Procesando...";
        errorEl.textContent = "";

        const payload = {
          a: document.getElementById("a").value.trim(),
          base_a: Number(document.getElementById("base_a").value),
          b: document.getElementById("b").value.trim(),
          base_b: Number(document.getElementById("base_b").value),
          op: document.getElementById("op").value,
          result_base: Number(document.getElementById("result_base").value),
        };

        try {
          const resp = await fetch("/calculate", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(payload),
          });

          const data = await resp.json();
          if (!resp.ok) throw new Error(data.detail);

          resultEl.innerHTML = `
      <div class="alert alert-success">Resultado: <strong>${data.result}</strong></div>
    `;
        } catch (err) {
          errorEl.textContent = "Error: " + err.message;
          resultEl.textContent = "";
        }
      });
    </script>
  </body>
</html>
